{% extends 'base.html.twig' %}

{% block title %}Mon Profil
{% endblock %}

{% block body %}
	<div class="container py-5">
		{% if profile %}
			<div class="row">
				<div class="col-md-4">
					<div class="card shadow-sm border-0 text-center p-4">
						<div class="mb-3">
							{% if profile.photo %}
								<img src="{{ asset('uploads/profiles/' ~ profile.photo) }}" alt="Avatar" class="rounded-circle img-thumbnail" style="width: 150px; height: 150px; object-fit: cover;">
							{% else %}
								<div class="rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px;">
									<i class="fas fa-user fa-4x text-muted"></i>
								</div>
							{% endif %}
						</div>
						<h4 class="mb-1">{{ profile.nom }}
							{% if profile.prenom is defined %}
								{{ profile.prenom }}
							{% endif %}
						</h4>
						<p class="text-muted">{{ app.user.email }}</p>
						<span class="badge bg-primary rounded-pill">
							{% if is_granted('ROLE_RECRUTEUR') %}Recruteur{% else %}Chercheur
							{% endif %}
						</span>
					</div>
				</div>
				<div class="col-md-8">
					<div class="card shadow-sm border-0">
						<div class="card-header bg-white border-bottom-0 pt-4 px-4">
							<h5 class="card-title mb-0">Modifier mes informations</h5>
						</div>
						<div class="card-body p-4">
							{{ form_start(form) }}
							<div class="row g-4">
								{% for field in form %}
									{% if field.vars.name != '_token' %}
										<div class="col-md-6">
											{{ form_label(field, null, {'label_attr': {'class': 'form-label fw-bold small text-uppercase'}}) }}
											{{ form_widget(field, {'attr': {'class': 'form-control rounded-3'}}) }}
											{{ form_errors(field) }}
										</div>
									{% endif %}
								{% endfor %}
							</div>
							<div class="mt-5 border-top pt-4">
								<button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow">
									<i class="fas fa-save me-2"></i>Sauvegarder les modifications
								</button>
							</div>
							{{ form_end(form) }}
						</div>
					</div>

					{% if is_granted('ROLE_RECRUTEUR') %}
						<div class="card shadow-sm border-0 mt-4">
							<div class="card-header bg-white border-bottom-0 pt-4 px-4">
								<h5 class="card-title mb-0">Mes Annonces</h5>
							</div>
							<div class="card-body p-4">
								<div class="list-group list-group-flush">
									{% for annonce in profile.annonces %}
										<div class="list-group-item px-0 py-3 d-flex align-items-center">
											<div class="flex-grow-1">
												<h6 class="mb-1">{{ annonce.titre }}</h6>
												<small class="text-muted">Publiée le
													{{ annonce.datePublication|date('d/m/Y') }}</small>
											</div>
											<div>
												<a href="{{ path('app_annonce_modifier', {id: annonce.id}) }}" class="btn btn-sm btn-outline-info">
													<i class="fas fa-edit"></i>
												</a>
											</div>
										</div>
									{% else %}
										<p class="text-muted italic">Vous n'avez pas encore publié d'annonces.</p>
									{% endfor %}
								</div>
							</div>
						</div>
					{% elseif is_granted('ROLE_CHERCHEUR') %}
						<div class="card shadow-sm border-0 mt-4">
							<div class="card-header bg-white border-bottom-0 pt-4 px-4">
								<h5 class="card-title mb-0">Mes Candidatures</h5>
							</div>
							<div class="card-body p-4">
								<div class="list-group list-group-flush">
									{% for candidature in profile.candidatures %}
										<div class="list-group-item px-0 py-3 d-flex align-items-center">
											<div class="flex-grow-1">
												<h6 class="mb-1">{{ candidature.annonceId.titre }}</h6>
												<small class="text-muted">Postulée le
													{{ candidature.datePro|date('d/m/Y') }}</small>
											</div>
											<div>
												<span class="badge {% if candidature.statut == 'En attente' %}bg-warning{% elseif candidature.statut == 'Accepté' %}bg-success{% else %}bg-secondary{% endif %} rounded-pill">
													{{ candidature.statut }}
												</span>
											</div>
										</div>
									{% else %}
										<p class="text-muted italic">Vous n'avez pas encore postulé à des annonces.</p>
									{% endfor %}
								</div>
							</div>
						</div>
					{% endif %}
				</div>
			</div>
		{% else %}
			<div class="alert alert-info shadow-sm border-0 rounded-4 p-4 text-center">
				<i class="fas fa-info-circle fa-2x mb-3"></i>
				<h4>Aucun profil associé</h4>
				<p class="mb-0">Votre compte utilisateur n'est pas lié à un profil Chercheur ou Recruteur. Si vous êtes administrateur, c'est normal.</p>
			</div>
		{% endif %}
	</div>
</div>{% endblock %}
