{% extends 'base.html.twig' %}

{% block title %}
	{{ 'Gestion des Candidatures'|trans }}
	| Bricolage
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<style>
		.candidate-card {
			background: white;
			border: none;
			border-radius: 20px;
			transition: all 0.3s ease;
			border-left: 5px solid transparent;
		}

		.candidate-card:hover {
			transform: translateX(10px);
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
		}

		.status-accepted {
			border-left-color: #10b981 !important;
		}
		.status-refused {
			border-left-color: #ef4444 !important;
		}
		.status-pending {
			border-left-color: #f59e0b !important;
		}

		.avatar-box {
			width: 65px;
			height: 65px;
			border-radius: 15px;
			background: #f1f5f9;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			color: #475569;
			font-size: 1.2rem;
			overflow: hidden;
		}

		.avatar-box img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.action-btn-group {
			background: #f8fafc;
			padding: 8px;
			border-radius: 50px;
		}
	</style>
{% endblock %}

{% block body %}
<div class="container py-5 mt-4">
	<div class="row mb-5 align-items-end">
		<div class="col-md-8">
			<h6 class="text-accent-primary fw-bold text-uppercase mb-2">{{ 'Recrutement'|trans }}</h6>
			<h1 class="display-5 fw-bold mb-0">{{ 'Candidatures ReÃ§ues'|trans }}</h1>
		</div>
		<div class="col-md-4 text-md-end mt-3 mt-md-0">
			<a href="{{ path('app_annonce') }}" class="btn btn-light rounded-pill px-4 fw-bold">
				<i class="fas fa-arrow-left me-2"></i>
				{{ 'Mes Annonces'|trans }}
			</a>
		</div>
	</div>

	{% if candidatures %}
		<div class="row g-4">
			{% for candidature in candidatures %}
				<div class="col-12">
					<div class="candidate-card shadow-sm p-4 {% if candidature.statut == 'AcceptÃ©' %}status-accepted{% elseif candidature.statut == 'RefusÃ©' %}status-refused{% else %}status-pending{% endif %}">
						<div class="row align-items-center">
							<div class="col-md-auto mb-3 mb-md-0">
								<div class="avatar-box shadow-sm">
									{% if candidature.chercheurId.photo %}
										<img src="{{ asset('uploads/profiles/' ~ candidature.chercheurId.photo) }}" alt="Avatar">
									{% else %}
										{{ candidature.chercheurId.prenom|slice(0, 1)|upper }}
									{% endif %}
								</div>
							</div>

							<div class="col-md ms-md-2">
								<div class="d-flex align-items-center gap-3 mb-2">
									<h5 class="fw-bold mb-0">{{ candidature.chercheurId.nom }}
										{{ candidature.chercheurId.prenom }}</h5>
									<span class="badge {% if candidature.statut == 'AcceptÃ©' %}bg-success{% elseif candidature.statut == 'RefusÃ©' %}bg-danger{% else %}bg-warning text-dark{% endif %} rounded-pill px-3 py-2 fw-bold" style="font-size: 0.7rem;">
										{{ candidature.statut|trans|upper }}
									</span>
								</div>

								<div class="d-flex flex-wrap gap-4 text-muted small">
									<span>
										<i class="fas fa-envelope me-2 opacity-50"></i>
										{{ candidature.chercheurId.email }}</span>
									<span>
										<i class="fas fa-briefcase me-2 opacity-50"></i>
										<strong>{{ candidature.annonceId.titre }}</strong>
									</span>
									<span>
										<i class="far fa-clock me-2 opacity-50"></i>
										{{ candidature.datePro|date('d/m/Y H:i') }}</span>
								</div>
							</div>

							<div class="col-lg-auto text-end mt-4 mt-lg-0">
								<div class="d-inline-flex action-btn-group shadow-sm">
									{% if candidature.statut != 'AcceptÃ©' %}
										<a href="{{ path('app_recruteur_candidature_statut', {id: candidature.id, statut: 'AcceptÃ©'}) }}" class="btn btn-success rounded-pill px-4 fw-bold me-1">
											<i class="fas fa-check me-2"></i>
											{{ 'Accepter'|trans }}
										</a>
									{% endif %}

									{% if candidature.statut != 'RefusÃ©' %}
										<a href="{{ path('app_recruteur_candidature_statut', {id: candidature.id, statut: 'RefusÃ©'}) }}" class="btn btn-outline-danger border-0 rounded-pill px-4 fw-bold">
											<i class="fas fa-times me-2"></i>
											{{ 'Refuser'|trans }}
										</a>
									{% endif %}

									<a href="{{ path('app_chat_conversation', {id: candidature.chercheurId.id}) }}" class="btn btn-white rounded-circle shadow-sm ms-2" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;">
										<i class="far fa-comment-dots text-primary"></i>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% else %}
		<div class="glass-card text-center p-5 rounded-4">
			<div class="mb-4">
				<i class="fas fa-inbox fa-5x text-accent-primary opacity-25"></i>
			</div>
			<h3 class="fw-bold">{{ 'Aucune candidature'|trans }}</h3>
			<p class="text-muted mb-4 fs-5">{{ 'Vous recevrez une notification dÃ¨s qu\'un expert proposera ses services.'|trans }}</p>
				<a href="{{ path('app_annonces_ajouter') }}" class="btn btn-primary rounded-pill px-5 py-3 shadow-lg fw-bold">
					<i class="fas fa-plus me-2"></i> {{ 'Publier une nouvelle offre'|trans }}
				</a>
			</div>
		{% endif %}
	</div>
{% endblock %}
