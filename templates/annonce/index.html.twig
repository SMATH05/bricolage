{% extends 'base.html.twig' %}

{% block title %}
	{{ 'Annonces'|trans }}
	| Bricolage
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<style>
		.annonce-hero {
			background: white;
			border-bottom: 1px solid #f1f5f9;
			padding: 40px 0;
			margin-bottom: 40px;
		}

		.job-card {
			border: none;
			border-radius: 20px;
			background: white;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			overflow: hidden;
			display: flex;
			flex-direction: column;
			height: 100%;
		}

		.job-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.08);
		}

		.job-card-image {
			height: 200px;
			position: relative;
			background: #f8fafc;
		}

		.job-card-image img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.budget-overlay {
			position: absolute;
			top: 15px;
			right: 15px;
			background: rgba(15, 23, 42, 0.9);
			color: white;
			backdrop-filter: blur(8px);
			padding: 6px 14px;
			border-radius: 10px;
			font-weight: 700;
			font-size: 0.9rem;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
			z-index: 2;
		}

		.job-type-badge {
			position: absolute;
			bottom: 15px;
			left: 15px;
			background: white;
			padding: 4px 12px;
			border-radius: 8px;
			font-size: 0.75rem;
			font-weight: 800;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			color: var(--accent-primary);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		}

		.job-card h5 {
			font-size: 1.15rem;
			font-weight: 700;
			color: #1e293b;
			margin-bottom: 10px;
		}

		.job-meta-list {
			list-style: none;
			padding: 0;
			margin: 0;
			display: flex;
			flex-wrap: wrap;
			gap: 12px;
		}

		.job-meta-item {
			font-size: 0.8rem;
			color: #64748b;
			display: flex;
			align-items: center;
		}

		.job-meta-item i {
			margin-right: 6px;
			opacity: 0.6;
		}
	</style>
{% endblock %}

{% block body %}
	<div class="annonce-hero">
		<div class="container">
			<div class="row align-items-center">
				<div class="col-md-8">
					<h1 class="fw-bold mb-2">{{ 'Opportunités de Projets'|trans }}</h1>
					<p class="text-muted mb-0">{{ 'Découvrez les dernières annonces et proposez vos services aux meilleurs tarifs.'|trans }}</p>
				</div>
				<div class="col-md-4 text-md-end mt-3 mt-md-0">
					{% if is_granted('ROLE_RECRUTEUR') or is_granted('ROLE_ADMIN') %}
						<a href="{{ path('app_annonces_ajouter') }}" class="btn btn-primary rounded-pill px-4 py-2 fw-bold shadow-lg">
							<i class="fas fa-plus me-2"></i>
							{{ 'Nouvelle Annonce'|trans }}
						</a>
					{% endif %}
				</div>
			</div>
		</div>
	</div>

	<div class="container pb-5">
		<div class="row g-4">
			{% for annonce in annonces %}
				<div class="col-md-6 col-lg-4">
					<div class="job-card shadow-sm">
						<div class="job-card-image">
							<div class="budget-overlay">{{ annonce.budget|number_format(0) }}
								€</div>
							<span class="job-type-badge">{{ 'Disponible'|trans }}</span>
							{% if annonce.photo %}
								<img src="{{ asset('uploads/annonces/' ~ annonce.photo) }}" alt="{{ annonce.titre }}">
							{% else %}
								{% set fallback_images = [
                                    'https://images.unsplash.com/photo-1581578731522-745d05cb9721?auto=format&fit=crop&q=80&w=800',
                                    'https://images.unsplash.com/photo-1595844730298-b960ff98fee0?auto=format&fit=crop&q=80&w=800',
                                    'https://images.unsplash.com/photo-1621905252507-b354bcadcabc?auto=format&fit=crop&q=80&w=800'
                                ] %}
								<img src="{{ fallback_images[annonce.id % 3] }}" alt="Bricolage">
							{% endif %}
						</div>
						<div class="card-body p-4 d-flex flex-column">
							<ul class="job-meta-list mb-3">
								<li class="job-meta-item">
									<i class="far fa-calendar-alt"></i>
									{{ annonce.datePublication|date('d M Y') }}
								</li>
								{% if is_granted('ROLE_RECRUTEUR') or is_granted('ROLE_ADMIN') %}
									<li class="job-meta-item">
										<i class="fas fa-users"></i>
										{{ annonce.candidatures|length }}
										{{ 'Postulants'|trans }}
									</li>
								{% endif %}
							</ul>

							<h5>{{ annonce.titre }}</h5>
							<p class="text-muted small mb-4 flex-grow-1">{{ annonce.description|slice(0, 110) }}...</p>

							<div class="d-flex align-items-center justify-content-between pt-3 border-top">
								<div class="btn-group">
									{% if is_granted('ROLE_RECRUTEUR') or is_granted('ROLE_ADMIN') %}
										<a href="{{ path('app_annonce_modifier', {id: annonce.id}) }}" class="btn btn-sm btn-light border rounded-pill me-2">
											<i class="fas fa-pen text-muted"></i>
										</a>
										<a href="{{ path('app_annonce_supprimer', {id: annonce.id}) }}" class="btn btn-sm btn-light border rounded-pill" onclick="return confirm('{{ 'Confirmer la suppression ?'|trans }}');">
											<i class="fas fa-trash text-danger"></i>
										</a>
									{% endif %}

									{% if is_granted('ROLE_CHERCHEUR') %}
										<a href="{{ path('app_candidature_ajouter', {annonce_id: annonce.id}) }}" class="btn btn-primary rounded-pill px-4 py-2 shadow-sm">
											<i class="fas fa-paper-plane me-1"></i>
											{{ 'Postuler'|trans }}
										</a>
									{% endif %}
								</div>

								{% if annonce.recrutId %}
									<div class="text-end d-none d-sm-block">
										<small class="text-muted d-block" style="font-size: 0.7rem;">{{ 'Client'|trans }}</small>
										<span class="fw-bold small">{{ annonce.recrutId.nom|slice(0, 15) }}</span>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			{% else %}
				<div class="col-12 py-5">
					<div class="glass-card text-center p-5 rounded-4">
						<i class="fas fa-search fa-3x mb-3 text-muted opacity-25"></i>
						<h4 class="fw-bold">{{ 'Aucune annonce disponible'|trans }}</h4>
						<p class="text-muted mb-0">{{ 'Veuillez revenir ultérieurement.'|trans }}</p>
					</div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
